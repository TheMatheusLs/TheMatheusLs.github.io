<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<title>Calculadora Nutricional ‚Äî Escola</title>
<meta name="description" content="Calculadora simples para dimensionar atividades de avalia√ß√£o nutricional, educa√ß√£o alimentar e teste de aceitabilidade por porte da escola." />
<style>
  :root{
    --bg: #fcf9f4;
    --card: #ffffff;
    --ink: #2f3941;
    --muted: #6b7278;
    --brand: #8cccad;   /* verde pastel */
    --accent: #ffd8a8;  /* p√™ssego pastel */
    --accent2:#c7d8ff;  /* azul claro pastel */
    --line: #eae7e2;
    --ring: #bfe4cf;
    --ok: #3a7a57;
    --warn:#a05a2c;

    /* cores para r√≥tulos */
    --tag-av: #c8ead7;
    --tag-ed: #ffe8c6;
    --tag-ta: #e7ddff;
    --tag-brd: rgba(0,0,0,.08);
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Noto Color Emoji", sans-serif;
    background: radial-gradient(1200px 600px at 85% -10%, var(--accent2) 0%, transparent 50%),
                radial-gradient(1000px 500px at -10% 110%, var(--accent) 0%, transparent 50%),
                var(--bg);
    color: var(--ink);
    line-height: 1.4;
  }

  .wrap{ max-width: 900px; margin: 0 auto; padding: clamp(16px, 4vw, 32px); }

  header{ display: grid; gap: 6px; margin-bottom: 18px; }
  .badge{
    display:inline-flex;align-items:center;gap:8px;
    background: var(--card);
    border: 1px solid var(--line);
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 12px;
    color: var(--muted);
  }
  .title{ font-size: clamp(22px, 3.6vw, 34px); font-weight: 800; letter-spacing: -0.02em; }
  .subtitle{ color: var(--muted); font-size: clamp(14px, 2.4vw, 16px); }

  .card{ background: var(--card); border: 1px solid var(--line); border-radius: 18px; box-shadow: 0 10px 24px rgba(0,0,0,0.04); }

  .grid{ display: grid; gap: 16px; }
  @media (min-width: 880px){
    .grid{ grid-template-columns: 1.1fr 1fr; align-items: start; }
  }

  .panel{ padding: 18px; }
  .panel + .panel{ border-top: 1px dashed var(--line); }
  .panel h2{
    margin: 0 0 8px;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--muted);
  }

  label{ font-weight: 600; display:block; margin-bottom: 8px; }
  .help{ color: var(--muted); font-size: 12px; }

  .input, .percent, .min-input{
    width: 100%;
    padding: 12px 14px;
    border: 1px solid var(--line);
    border-radius: 12px;
    background: #fff;
    font-size: 16px;
    outline: none;
    transition: border .2s, box-shadow .2s;
  }
  .input:focus, .percent:focus, .min-input:focus{
    border-color: var(--brand);
    box-shadow: 0 0 0 4px var(--ring);
  }

  .btn{
    appearance: none; border: none; background: var(--brand); color: #0e3323; font-weight: 800;
    padding: 12px 16px; border-radius: 12px; cursor: pointer; transition: transform .05s ease, box-shadow .2s ease;
    box-shadow: 0 6px 16px rgba(60, 140, 100, 0.25);
  }
  .btn:active{ transform: translateY(1px); }
  .btn.ghost{ background: #fff; color: var(--ink); border: 1px dashed var(--brand); box-shadow: none; }

  .results{ display: grid; gap: 12px; }
  .result-line{
    display: grid; gap: 8px; background: #fff; border: 1px solid var(--line); border-radius: 14px; padding: 14px;
  }
  .result-head{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .tag{
    display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid var(--tag-brd); font-size:12px;
  }
  .tag.av{ background: var(--tag-av); }
  .tag.ed{ background: var(--tag-ed); }
  .tag.ta{ background: var(--tag-ta); }

  .count{ font-size: clamp(22px, 5vw, 32px); font-weight: 900; letter-spacing: -0.02em; color: #0f3b28; }
  .subtle{ color: var(--muted); font-size: 12px; margin-top:-4px; }

  .notice{
    background: linear-gradient(0deg, #fff, #fff) padding-box,
                conic-gradient(from 180deg at 50% 100%, var(--accent) 0 25%, var(--accent2) 25% 50%, #e6ffe6 50% 75%, #ffe6f2 75% 100%) border-box;
    border: 2px solid transparent; border-radius: 14px; padding: 12px 14px; color: var(--warn); font-size: 14px;
  }

  details{ border-top: 1px dashed var(--line); padding-top: 14px; margin-top: 10px; }
  summary{ cursor: pointer; list-style: none; font-weight: 700; color: #0e3323; }
  summary::marker{ display:none; }

  .rules{ display: grid; gap: 10px; grid-template-columns: 1fr 1fr 1fr; margin-top: 10px; }
  .rules > div{ border: 1px dashed var(--line); border-radius: 12px; padding: 10px; background: #fff; }
  .rules label{ font-size: 12px; margin: 0 0 6px; color: var(--muted); }
  .percent{ text-align: right; }
  .percent::-webkit-outer-spin-button, .percent::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }

  .rules-extra{ display:grid; gap:10px; grid-template-columns: 1fr 1fr; margin-top:12px; }

  .foot{ text-align: center; color: var(--muted); font-size: 12px; margin-top: 14px; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <span class="badge">ü•ó Calculadora Nutricional Escolar</span>
      <div class="title">Planejamento GRE</div>
      <div class="subtitle">Informe o n√∫mero total de alunos. O porte da escola ser√° detectado automaticamente conforme as regras.</div>
    </header>

    <div class="grid">
      <!-- COLUNA ESQUERDA: ENTRADAS -->
      <div class="card">
        <div class="panel">
          <h2>Dados de entrada</h2>
          <label for="totalAlunos">N√∫mero total de alunos</label>
          <input class="input" id="totalAlunos" type="number" min="0" step="1" placeholder="Ex.: 850" inputmode="numeric" />
          <div class="help">Use n√∫meros inteiros. Valores fracionados ser√£o arredondados.</div>
        </div>

        <div class="panel">
          <details>
            <summary>‚öôÔ∏è Ajustar regras (toque para abrir)</summary>

            <!-- Avalia√ß√£o nutricional e Aceitabilidade -->
            <div class="rules-extra">
              <div>
                <label for="pctAval">Avalia√ß√£o nutricional ‚Äî % do total</label>
                <input id="pctAval" class="percent" type="number" min="0" max="100" step="1" value="30" />
              </div>
              <div>
                <label for="minAceit">Teste de aceitabilidade ‚Äî m√≠nimo</label>
                <input id="minAceit" class="min-input" type="number" min="0" step="1" value="100" />
              </div>
            </div>

            <!-- Educa√ß√£o alimentar por porte -->
            <div class="rules" aria-label="Percentuais por porte (Educa√ß√£o alimentar)">
              <div>
                <label for="pctPequena">Educa√ß√£o (Pequena) %</label>
                <input id="pctPequena" class="percent" type="number" min="0" max="100" step="1" value="30" />
              </div>
              <div>
                <label for="pctMedia">Educa√ß√£o (M√©dia) %</label>
                <input id="pctMedia" class="percent" type="number" min="0" max="100" step="1" value="20" />
              </div>
              <div>
                <label for="pctGrande">Educa√ß√£o (Grande) %</label>
                <input id="pctGrande" class="percent" type="number" min="0" max="100" step="1" value="10" />
              </div>
            </div>
            <div class="foot">Ajuste conforme sua norma/nota t√©cnica.</div>
          </details>
        </div>

        <div class="panel" style="display:flex; gap:10px; align-items:center;">
          <button class="btn" id="btnCalcular">Calcular</button>
          <button class="btn ghost" id="btnLimpar" title="Limpar campos">Limpar</button>
        </div>
      </div>

      <!-- COLUNA DIREITA: RESULTADOS -->
      <div class="card">
        <div class="panel">
          <h2>Resultados</h2>
          <div id="aviso" class="notice" style="display:none"></div>
          <div class="results" id="results">

            <div class="result-line">
              <div class="result-head"><span class="tag av">Avalia√ß√£o nutricional</span></div>
              <div class="count" id="outAval">‚Äî</div>
              <div class="subtle">Usando <span id="pctAvalUsed">30</span>% do total de alunos.</div>
            </div>

            <div class="result-line">
              <div class="result-head"><span class="tag ed">Educa√ß√£o alimentar</span></div>
              <div class="count" id="outEduc">‚Äî</div>
              <div class="subtle">Usando <span id="pctEducUsed">‚Äî</span>% do total de alunos. <span id="porteInfo" style="font-weight:600"></span></div>
            </div>

            <div class="result-line">
              <div class="result-head"><span class="tag ta">Teste de aceitabilidade</span></div>
              <div class="count" id="outAceit">‚Äî</div>
              <div class="subtle">M√≠nimo de <span id="minAceitUsed">100</span> alunos.</div>
            </div>

          </div>
        </div>
        <div class="panel">
          <div class="help">
            Arredondamos para cima para garantir amostra suficiente.
          </div>
        </div>
      </div>
    </div>

    <footer class="foot">
      Laryssa Silva ü•ëü•ï ‚Äî por Matheus L√¥bo &copy;
    </footer>
  </div>

<script>
(function(){
  // ===== Utilit√°rios compat√≠veis =====
  var $ = function(sel){ return document.querySelector(sel); };
  var $$ = function(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); };
  var fmtInt = function(n){
    try{
      if (window.Intl && Intl.NumberFormat) return new Intl.NumberFormat('pt-BR').format(n);
      return String(n);
    }catch(e){ return String(n); }
  };

  function getPorte(total){
    if (!(typeof Number.isFinite === "function" ? Number.isFinite(total) : isFinite(total))) return 'pequena';
    if (total <= 100) return 'pequena';
    if (total <= 599) return 'media';
    return 'grande';
  }

  function clampPct(v){ if (isNaN(v)) return 0; return Math.min(100, Math.max(0, v)); }
  function ceilSafe(x){ if (!(typeof Number.isFinite === "function" ? Number.isFinite(x) : isFinite(x))) return 0; return Math.ceil(x); }

  function getPercEduc(porte){
    var pPeq = clampPct(parseFloat(($('#pctPequena').value || '30')));
    var pMed = clampPct(parseFloat(($('#pctMedia').value || '20')));
    var pGra = clampPct(parseFloat(($('#pctGrande').value || '10')));
    var map = { pequena: pPeq, media: pMed, grande: pGra };
    var sel = map.hasOwnProperty(porte) ? map[porte] : 20;
    return sel / 100;
  }

  function getPctAval(){ return clampPct(parseFloat(($('#pctAval').value || '30'))) / 100; }
  function getMinAceit(){
    var m = parseInt($('#minAceit').value, 10);
    return isNaN(m) || m < 0 ? 0 : m;
  }

  function calcular(){
    var aviso = $('#aviso');
    aviso.style.display = 'none'; aviso.textContent = '';

    // leitura robusta p/ iOS
    var raw = (($('#totalAlunos').value || '') + '').replace(/[^0-9]/g, '');
    var total = parseInt(raw, 10);
    if (isNaN(total) || total < 0) total = 0;

    var porte = getPorte(total);
    var pEduc = getPercEduc(porte);
    var pAval = getPctAval();
    var minAceit = getMinAceit();

    // C√°lculos
    var avaliacao = ceilSafe(total * pAval);
    var educacao  = ceilSafe(total * pEduc);
    var aceit     = Math.max(minAceit, 0);

    if (total > 0 && total < minAceit){
      aviso.style.display = 'block';
      aviso.innerHTML = 'Aviso: o m√≠nimo de <strong>' + fmtInt(minAceit) + ' alunos</strong> para o teste de aceitabilidade excede o total informado (' + fmtInt(total) + ').';
    }

    // Sa√≠das
    $('#outAval').textContent = total ? (fmtInt(avaliacao) + ' alunos') : '‚Äî';
    $('#outEduc').textContent = total ? (fmtInt(educacao) + ' alunos') : '‚Äî';
    $('#outAceit').textContent = total ? (fmtInt(aceit) + ' alunos') : '‚Äî';

    // Indicadores
    $('#pctAvalUsed').textContent = Math.round(pAval * 100);
    $('#pctEducUsed').textContent = Math.round(pEduc * 100);
    $('#minAceitUsed').textContent = minAceit;
    var porteTxt = (porte === 'pequena') ? 'Porte detectado: Pequena' : ((porte === 'media') ? 'Porte detectado: M√©dia' : 'Porte detectado: Grande');
    $('#porteInfo').textContent = total ? ('(' + porteTxt + ')') : '';
  }

  function limpar(){
    $('#totalAlunos').value = '';

    // Defaults pedidos
    $('#pctPequena').value = 30;
    $('#pctMedia').value = 20;
    $('#pctGrande').value = 10;
    $('#pctAval').value = 30;
    $('#minAceit').value = 100;

    $('#aviso').style.display = 'none';
    $('#aviso').textContent = '';
    $('#outAval').textContent = '‚Äî';
    $('#outEduc').textContent = '‚Äî';
    $('#outAceit').textContent = '‚Äî';
    $('#pctAvalUsed').textContent = '30';
    $('#pctEducUsed').textContent = '‚Äî';
    $('#minAceitUsed').textContent = '100';
    $('#porteInfo').textContent = '';

    // foca e dispara c√°lculo para refletir defaults
    var el = $('#totalAlunos');
    try{ el.focus(); }catch(e){}
    calcular();
  }

  function bind(){
    $('#btnCalcular').addEventListener('click', calcular);
    $('#btnLimpar').addEventListener('click', limpar);

    // iOS pode ignorar 'input' em type=number; ent√£o tamb√©m usamos 'change' e 'keyup'
    $('#totalAlunos').addEventListener('input', calcular);
    $('#totalAlunos').addEventListener('change', calcular);
    $('#totalAlunos').addEventListener('keyup', calcular);

    ['#pctPequena','#pctMedia','#pctGrande','#pctAval','#minAceit'].forEach(function(sel){
      var node = $(sel);
      node.addEventListener('input', calcular);
      node.addEventListener('change', calcular);
      node.addEventListener('keyup', calcular);
    });
  }

  // Garante execu√ß√£o no Safari / iOS mesmo em pr√©-visualizadores:
  function ready(fn){
    if (document.readyState === 'complete' || document.readyState === 'interactive'){
      setTimeout(fn, 0);
    }else{
      document.addEventListener('DOMContentLoaded', fn);
    }
  }

  ready(function(){
    bind();
    limpar();
  });
})();
</script>
</body>
</html>